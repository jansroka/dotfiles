---
# from https://github.com/geerlingguy/ansible-collection-mac
# Note: Using native macOS APIs instead of dockutil for better compatibility.

- name: Set Dock settings
  community.general.osx_defaults: domain=com.apple.dock key={{ item.key }} type={{ item.type }} value={{ item.value }}
  loop:
    # Enable highlight hover effect for the grid view of a stack (Dock)
    - {key: "mouse-over-hilite-stack", type: "bool", value: "true"}
    # Set the icon size (px) of Dock items
    - {key: "tilesize", type: "float", value: "{{ dock_icon_size }}"}
    # Show indicator lights for open applications in the Dock
    - {key: "show-process-indicators", type: "bool", value: "true"}
    # Speed up Mission Control animations
    - {key: "expose-animation-duration", type: "float", value: "0.1"}
    # Donâ€™t show Dashboard as a Space
    - {key: "dashboard-in-overlay", type: "bool", value: "false"}
  notify:
    - Kill Dock
  tags: dock

- name: Reset persistent dock items (native API)
  ansible.builtin.command: defaults write com.apple.dock persistent-apps -array
  become: true
  become_user: jan
  changed_when: false
  notify:
    - Kill Dock
  tags: dock

- name: Add dock items using native API
  ansible.builtin.command: >
    defaults write com.apple.dock persistent-apps -array-add
    "<dict><key>tile-data</key><dict><key>file-label</key><string>{{ item.name }}</string></dict><key>tile-type</key><string>file-tile</string></dict>"
  become: true
  become_user: jan
  loop: "{{ dock_items_persist }}"
  changed_when: false
  notify:
    - Kill Dock
  tags: dock
